---
title: 遇到问题 > useState
categories:
  - - 计算机
    - React
date: '2022-06-30 14:20:43'
---

遇到问题的代码：

```jsx
import React, { ReactNode } from "react"
import Head from "next/head"
import Header from "./Header"

const Layout = ({ children }: { children: React.ReactNode }) => {
  return (
    <div>
      <Head>
        <title>Xiaobo's Blog</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Header />
      <main className="px-5 mt-12">
        <div className="max-w-[700px] m-auto">{children}</div>
      </main>
    </div>
  )
}

export default Layout
```

在 input 绑定了事件，获取输出的值，存储到 state 中

更新状态使用了回调的形式

结果是从第二次输入开始，setItem 更新后的值总是为空，不知为何。

在 setItem 回调函数中 target.value 为空，但是在外面就不是

使用直接更新的方式，setItem 无异常

[Google 了一圈看到了一篇博客](https://segmentfault.com/a/1190000040013137)

其中第二个问题《**useState 异步回调的问题**》中第二个解决方法

虽然和我遇到的问题好像不相干，但是这个解决方法给了我灵感：

先把 target.value 的值保存以下，然后在更新状态行不行呢？

```jsx
const handleInput = e => {
  //先把值保存一下
  const keyCode = e.keyCode
  const value = e.target.value

  if (keyCode !== 13 || value.trim() === "") return
  setItem(prev => [...prev, { id: nanoid(), value }])

  e.target.value = ""
}

;<input type="text" className="input" placeholder="输入主题" onKeyUp={handleInput} />
```

成了！

目前还不知道是什么原理，先记录下来
